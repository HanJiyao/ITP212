<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:p="http://primefaces.org/ui">

<f:metadata>
    <f:event type="preRenderView" listener="#{reviewController.loadReviews()}"/>
</f:metadata>

<h:head>
    <meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
</h:head>

<h:body>
    <ui:composition template="templates/template.xhtml">
    <ui:define name="content">
    <style type="text/css">
    .ui-dashboard-column {width:200px;}

    .rev {
        width: 50%
    }
    </style>
    <div id="wrapper">
        <div id="header">
            <h2>Listing</h2>
        </div>
    </div>

    <div id="container">

        <div id="content">

            <h:messages globalOnly="true" />
            <!--  add a search box -->
            <!--<h:form>-->

                <!--<h:outputLabel>Search review:</h:outputLabel> <h:inputText value="#{reviewController.theSearchName}" id="theSearchName" />-->

                <!--<p:commandButton value="Search" action="review?faces-redirect=true"/>-->

            <!--</h:form>-->


            <br/>

            <p:button value="Add Review" outcome="add-review-form.xhtml" />

            <br/>

            <div id="calculate">
                <h:panelGrid columns="2" cellpadding="5" style="width:25%">
                    Average Rating:<p:rating name="header" value="#{reviewController.ratee}" readonly="true" />
                </h:panelGrid>
            </div>

            <h:form>

                <p:dataTable var="tempReview" value="#{reviewController.reviews}"  paginator="true" rows="3"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}">

                    <p:column sortBy="#{tempReview.displayName}">
                        <!-- the column header -->
                        <f:facet name="header">
                            User
                            <h:inputText value="#{reviewController.searchUser}" id="searchUser" />
                        </f:facet>
                        <h:outputText value="#{tempReview.displayName}" />

                        <!--&lt;!&ndash;  the value for each row &ndash;&gt;-->
                        <!--#{tempReview.displayName}-->
                    </p:column>

                    <p:column headerText="Reviews" sortBy="#{tempReview.reviewText}" styleClass="rev">
                        <f:facet name="header">
                            Reviews
                            <h:inputText value="#{reviewController.theSearchName}" id="theSearchName" />
                        </f:facet>

                        <h:outputText value="#{tempReview.reviewText}" />
                        <br/>
                        <span style="font-size: small">
                        Posted at:
                        #{tempReview.reviewDate} | #{tempReview.reviewTime}
                        </span>
                    </p:column>

                    <p:column headerText="Rating" sortBy="#{tempReview.rating}">
                        <!-- the column header -->
                        <!--<f:facet name="header">-->
                            <!--Rating-->
                        <!--</f:facet>-->

                        <!--  the value for each row -->
                        <p:rating value="#{tempReview.rating}" readonly="true" />
                    </p:column>


                    <!--<h:column>-->
                        <!--&lt;!&ndash; the column header &ndash;&gt;-->
                        <!--<f:facet name="header">Rating</f:facet>-->

                        <!--&lt;!&ndash;  the value for each row &ndash;&gt;-->
                        <!--<p:rating value="#{tempReview.date}" readonly="true" />-->
                    <!--</h:column>-->


                    <!--<ui:fragment rendered="#{tempReview.reviewUId == session.reviewUId}">-->
                    <p:column>
                        <!-- column header -->


                        <!-- the value for each row -->
                        <p:commandLink value="Update"
                                       action="#{reviewController.loadReview(tempReview.id)}" />

                        |

                        <p:commandLink value="Delete"
                                       onclick="if (!confirm('Are you sure you want to delete this review?'))return false"
                                       action="#{reviewController.deleteReview(tempReview.id)}" />

                    </p:column>
                    <!--</ui:fragment>-->

                </p:dataTable>

            </h:form>

        </div>

    </div>
    </ui:define>
    </ui:composition>
</h:body>
</html>